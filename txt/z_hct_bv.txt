z_hct_bv01:--z_hct_bv01
	declare @t_bdate nvarchar(max)
	declare @t_edate nvarchar(max)
	declare @t_order nvarchar(max)
	declare @t_noa nvarchar(max)
	declare @t_userno nvarchar(max)
	declare @t_out nvarchar(max)
	declare @t_bcustno nvarchar(max)
	declare @t_ecustno nvarchar(max)
	set @t_bdate = case when '#non'=[2] then '' else [2] end
	set @t_edate = case when '#non'=[3] then CHAR(255) else [3] end
	set @t_order = case when '#non'=[4] then '' else [4] end
	set @t_noa = case when '#non'=[5] then '' else [5] end
	set @t_userno = case when '#non'='[6]' then '' else '[6]' end
	set @t_out = case when '#non'='[7]' then '1' else '[7]' end
	set @t_bcustno = case when '#non'=[8] then '' else [8] end
	set @t_ecustno = case when '#non'=[9] then CHAR(255) else [9] end
	--*****************************************************************************************	
--select '0' gno,a.boatname,a.po,a.mon,a.custno,a.comp,a.addressee,a.atel,a.boat,a.caseend,a.aaddr
--,b.datea,b.nick,b.salesno,b.checkno,b.money,b.memo
--from view_transef a left join borrc b 
--on (case when left(b.comp,2)='97' then a.boatname else a.po end)=b.comp
--where (a.boatname=@t_noa or @t_noa=a.po) and a.boatname!='' and @t_noa!=''
--and a.po!=''
--order by a.boatname

declare @result table(
	gno nvarchar(1),
	idno int identity(0,1),
	recno int,
	noa nvarchar(50),
	status nvarchar(30),
	xchk nvarchar(20),
	comp nvarchar(MAX),
	conn nvarchar(MAX),
	tel nvarchar(MAX),
	addr nvarchar(MAX)
)

insert @result
select '0'
,ROW_NUMBER() over (order by  case when @t_order='2' then a.po when @t_order='1' then (case when isnull(b.comp,'')!='' then '1' else '0' end) else (case when isnull(b.comp,'')!='' then '1' else '0' end) end,a.po)
,a.boatname
,case when isnull(b.comp,'')!='' then '配達完成' else '未收貨' end
,case when isnull(b.comp,'')!='' then '是' else '否' end
,a.comp,a.addressee,a.atel,a.aaddr
from view_transef a left join borrc b 
on (case when left(b.comp,2)='97' then a.boatname else a.po end)=b.comp
where --a.po!='' --需配送
--and 
(@t_out='0' or a.custno=@t_userno )
and (@t_out='1' or a.custno between @t_bcustno and @t_ecustno  )
and (a.trandate between @t_bdate and @t_edate) 
and (len(@t_noa)=0 or (case when left(b.comp,2)='97' then a.boatname else a.po end)= @t_noa)
order by  case when @t_order='2' then a.po when @t_order='1' then (case when isnull(b.comp,'')!='' then '1' else '0' end) else (case when isnull(b.comp,'')!='' then '1' else '0' end) end,a.po

if((select count(*) from @result)=0)
begin
	insert @result (gno,comp)
	select '1',(select top 1 comp from cust where noa=@t_userno)
end

select recno xrecno
,'<a href="https://www.hct.com.tw/fsdex/search_goods_result.aspx" target="_blank" >'+noa+'<a> ' ynoa
,* 
from @result a order by a.recno
;